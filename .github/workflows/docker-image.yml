name: Build and push Image

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    defaults:                                             # <<-- Add default working directory
      run:                                                # <<-- here to ensure deployment 
        working-directory: ./Humongous.Healthcare/
    steps:
    - uses: actions/checkout@v3
    
    - uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
        
    - name: Build the Docker image
      run: docker build . --file Dockerfile --tag humongous-healthcare-api:$(date +%s)
        
    - name: Tag the docker image
      run: docker tag humongous-healthcare-api:$(date +%s) daiworkshopacrkpan.azurecr.io/humongous-healthcare-api:$(date +%s)

    - name: Push the image
      run: docker push daiworkshopacrkpan.azurecr.io/humongous-healthcare-api:$(date +%s)
